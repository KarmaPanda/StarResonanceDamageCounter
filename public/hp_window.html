<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Health Bar Monitor</title>
        <script src="./socket.io.min.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
                background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
                color: #ffffff;
                overflow: hidden;
                user-select: none;
            }

            .container {
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 6px 8px;
                background: rgba(0, 0, 0, 0.2);
                backdrop-filter: blur(10px);
            }

            .header-left {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                flex: 1;
            }

            .header-center {
                display: flex;
                gap: 6px;
                flex: 2;
                justify-content: center;
            }

            .header-right {
                display: flex;
                align-items: center;
                flex: 1;
                justify-content: flex-end;
            }

            .title {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 1px;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }

            .subtitle {
                font-size: 11px;
                opacity: 0.8;
            }

            .controls {
                display: flex;
                gap: 6px;
            }

            .btn {
                padding: 4px 8px;
                font-size: 11px;
                border: none;
                border-radius: 4px;
                background: rgba(255, 255, 255, 0.2);
                color: white;
                cursor: pointer;
                transition: all 0.3s ease;
                backdrop-filter: blur(10px);
            }

            .btn:hover {
                background: rgba(255, 255, 255, 0.3);
                transform: translateY(-1px);
            }

            .btn.active {
                background: #4caf50;
                box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
            }

            .hp-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-auto-rows: 45px;
                flex: 1;
                overflow-y: auto;
                align-content: start;
            }

            /* Custom scrollbar */
            .hp-grid::-webkit-scrollbar {
                width: 6px;
            }

            .hp-grid::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 3px;
            }

            .hp-grid::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.3);
                border-radius: 3px;
            }

            .hp-grid::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 255, 255, 0.5);
            }

            .player-card {
                background: rgba(0, 0, 0, 0.25);
                border-radius: 8px;
                padding: 6px;
                backdrop-filter: blur(15px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                height: 45px;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }

            .player-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
                border-color: rgba(255, 255, 255, 0.2);
            }

            .player-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 2px;
                background: var(--profession-color, #4caf50);
                opacity: 0.8;
            }

            .player-info {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 4px;
                flex-wrap: wrap;
                gap: 4px;
            }

            .player-basic {
                display: flex;
                align-items: center;
                gap: 6px;
                flex: 1;
                min-width: 0;
            }

            .player-name {
                font-size: 12px;
                font-weight: 600;
                color: #ffffff;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                min-width: 0;
            }

            .player-profession {
                font-size: 9px;
                padding: 1px 4px;
                border-radius: 8px;
                background: var(--profession-color, #4caf50);
                color: white;
                font-weight: 500;
                white-space: nowrap;
            }

            .player-stats {
                display: flex;
                gap: 8px;
                font-size: 9px;
                opacity: 0.9;
                align-items: center;
            }

            .hp-container {
                margin-bottom: 0;
                position: relative;
            }

            .hp-text {
                display: flex;
                justify-content: space-between;
                align-items: center;
                font-size: 10px;
                position: absolute;
                left: 0;
                right: 0;
                top: 50%;
                transform: translateY(-50%);
                z-index: 2;
                pointer-events: none;
            }

            .hp-current {
                font-weight: 600;
                color: #ffffff;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
                margin-left: 4px;
            }

            .hp-max {
                color: #ffffff;
                opacity: 0.9;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
                margin-right: 4px;
            }

            .hp-percentage {
                color: #ffffff;
                font-weight: 600;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
            }

            .hp-bar {
                height: 14px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 3px;
                overflow: hidden;
                position: relative;
            }

            .hp-fill {
                height: 100%;
                background: linear-gradient(90deg, var(--hp-color, #4caf50) 0%, var(--hp-color-light, #66bb6a) 100%);
                border-radius: 3px;
                transition:
                    width 0.5s ease,
                    background-color 0.3s ease;
                position: relative;
            }

            .hp-bar::after {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.2) 50%, transparent 100%);
                animation: shine 6s infinite;
            }

            @keyframes shine {
                0% {
                    transform: translateX(-100%);
                }
                100% {
                    transform: translateX(100%);
                }
            }

            .stat-item {
                display: flex;
                align-items: center;
                gap: 2px;
                font-weight: 500;
                color: rgba(255, 255, 255, 0.9);
            }

            .stat-icon {
                font-size: 8px;
                opacity: 0.8;
            }

            .stat-value {
                font-size: 9px;
                font-weight: 600;
            }

            /* Health status colors */
            .hp-critical {
                --hp-color: #f44336;
                --hp-color-light: #ef5350;
            }

            .hp-warning {
                --hp-color: #ff9800;
                --hp-color-light: #ffb74d;
            }

            .hp-healthy {
                --hp-color: #4caf50;
                --hp-color-light: #66bb6a;
            }

            .hp-full {
                --hp-color: #2196f3;
                --hp-color-light: #42a5f5;
            }

            /* Class colors */
            .profession-damage {
                --profession-color: #f44336;
            }
            .profession-tank {
                --profession-color: #2196f3;
            }
            .profession-heal {
                --profession-color: #4caf50;
            }
            .profession-support {
                --profession-color: #ff9800;
            }
            .profession-unknown {
                --profession-color: #9e9e9e;
            }

            .no-data {
                grid-column: 1 / -1;
                text-align: center;
                padding: 40px;
                opacity: 0.6;
                font-size: 14px;
            }

            .connection-status {
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 10px;
                font-weight: 600;
                backdrop-filter: blur(10px);
                transition: all 0.3s ease;
                white-space: nowrap;
            }

            .status-connected {
                background: rgba(76, 175, 80, 0.8);
                color: white;
            }

            .status-disconnected {
                background: rgba(244, 67, 54, 0.8);
                color: white;
            }

            .status-connecting {
                background: rgba(255, 152, 0, 0.8);
                color: white;
            }

            /* Responsive layout - small screen optimization */
            @media (max-width: 600px) {
                .header {
                    flex-direction: column;
                    text-align: center;
                }

                .header-left,
                .header-center,
                .header-right {
                    flex: none;
                    width: 100%;
                    justify-content: center;
                }

                .header-left {
                    align-items: center;
                }

                .player-card {
                    padding: 6px;
                }

                .player-stats {
                    gap: 6px;
                }

                .player-name {
                    font-size: 11px;
                }
            }

            /* Narrow screen mode: only show control buttons */
            @media (max-width: 700px) {
                .header {
                    flex-direction: row;
                    justify-content: center;
                    gap: 0;
                    padding: 4px 6px;
                }

                .header-left,
                .header-right {
                    display: none;
                }

                .header-center {
                    flex: 1;
                    width: auto;
                }

                .controls {
                    gap: 3px;
                }

                .btn {
                    font-size: 9px;
                    padding: 3px 5px;
                }
            }

            /* Extra narrow screen mode: hide DPS and other data */
            @media (max-width: 400px) {
                /* Hide player statistics */
                .player-stats {
                    display: none;
                }
            }

            /* Extra narrow screen mode: hide header */
            @media (max-width: 300px) {
                .header {
                    display: none;
                }
            }

            /* Dynamic entry animation */
            .player-card {
                animation: slideInUp 0.6s ease-out;
                transition:
                    all 0.3s ease,
                    opacity 0.2s ease;
            }

            .player-card:nth-child(even) {
                animation-delay: 0.1s;
            }

            /* Smooth transition for hidden state */
            .player-card[style*='display: none'] {
                opacity: 0;
                transform: translateY(-10px);
            }

            @keyframes slideInUp {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            /* Low health blinking effect */
            .hp-critical .player-card {
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0%,
                100% {
                    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
                }
                50% {
                    box-shadow: 0 8px 20px rgba(244, 67, 54, 0.4);
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <div class="header-left">
                    <div class="title">🩸 Health Bar Monitor</div>
                    <div class="subtitle" id="playerCount">Waiting for data connection...</div>
                </div>

                <div class="header-center">
                    <div class="controls">
                        <button class="btn active" id="sortHpBtn" onclick="setSortMode('hp')">💚 By Health</button>
                        <button class="btn" id="sortNameBtn" onclick="setSortMode('name')">🏷️ By Name</button>
                        <button class="btn" id="sortDpsBtn" onclick="setSortMode('dps')">⚔️ By DPS</button>
                        <button class="btn" id="sortHpsBtn" onclick="setSortMode('hps')">🩹 By HPS</button>
                    </div>
                </div>

                <div class="header-right">
                    <div class="connection-status status-connecting" id="connectionStatus">🔄 Connecting</div>
                </div>
            </div>

            <div class="hp-grid" id="playerGrid">
                <div class="no-data">
                    <div>🔄 Connecting to server...</div>
                </div>
            </div>
        </div>

        <script>
            // Global variables
            let socket = null;
            let isWebSocketConnected = false;
            let apiInterval = null;
            let isPaused = false;
            let currentSortMode = 'hp';
            let currentPlayers = [];
            let playerCards = []; // Pre-generated card array
            const MAX_CARDS = 20; // Maximum number of cards

            // Class mapping
            const professionMap = {
                Stormblade: { type: 'damage', color: '#e74c3c', short_name: 'Stormblade' },
                'Frost Mage': { type: 'damage', color: '#e74c3c', short_name: 'Frost Mage' },
                'Wind Knight': { type: 'damage', color: '#e74c3c', short_name: 'Wind Knight' },
                Marksman: { type: 'damage', color: '#e74c3c', short_name: 'Marksman' },
                'Cleansing Hellfire Axe': { type: 'damage', color: '#e74c3c', short_name: 'Hellfire Axe' },
                'Thunder Flash Cannon': { type: 'damage', color: '#e74c3c', short_name: 'Thunder Cannon' },
                'Dark Spirit Prayer Dance Ceremonial Blade': { type: 'damage', color: '#e74c3c', short_name: 'Dark Ceremonial Blade' },
                'Verdant Oracle': { type: 'heal', color: '#27ae60', short_name: 'Verdant Oracle' },
                'Beat Performer': { type: 'heal', color: '#27ae60', short_name: 'Beat Performer' },
                'Heavy Guardian': { type: 'tank', color: '#2980b9', short_name: 'Heavy Guardian' },
                'Shield Knight': { type: 'tank', color: '#2980b9', short_name: 'Shield Knight' },
            };

            // Initialize connection
            function initConnection() {
                initWebSocket();
                monitorConnection();
            }

            // WebSocket connection
            function initWebSocket() {
                try {
                    socket = io();

                    socket.on('connect', () => {
                        console.log('WebSocket connection successful');
                        isWebSocketConnected = true;
                        stopAPIFallback();
                        updateConnectionStatus('connected');
                    });

                    socket.on('data', (data) => {
                        if (!isPaused && data && data.user) {
                            processData(data.user);
                        }
                    });

                    socket.on('disconnect', () => {
                        console.log('WebSocket connection closed');
                        isWebSocketConnected = false;
                        updateConnectionStatus('disconnected');
                    });

                    socket.on('connect_error', (error) => {
                        console.error('WebSocket connection error:', error);
                        isWebSocketConnected = false;
                        updateConnectionStatus('disconnected');
                    });
                } catch (error) {
                    console.error('WebSocket initialization failed:', error);
                    startAPIFallback();
                }
            }

            // Monitor connection status
            function monitorConnection() {
                setInterval(() => {
                    if (!isWebSocketConnected && !apiInterval) {
                        console.log('WebSocket disconnected, switching to API polling');
                        startAPIFallback();
                    }
                }, 3000);
            }

            // Start API backup mode
            function startAPIFallback() {
                if (apiInterval) return;

                console.log('Starting API polling mode');
                updateConnectionStatus('api');
                apiInterval = setInterval(fetchDataFromAPI, 100);
            }

            // Stop API backup mode
            function stopAPIFallback() {
                if (apiInterval) {
                    clearInterval(apiInterval);
                    apiInterval = null;
                    console.log('Stopping API polling mode');
                }
            }

            // Get data from API
            async function fetchDataFromAPI() {
                if (isPaused) return;

                try {
                    const response = await fetch('/api/data');
                    const data = await response.json();
                    if (data.code === 0 && data.user) {
                        processData(data.user);
                    }
                } catch (error) {
                    console.error('API request failed:', error);
                    updateConnectionStatus('disconnected');
                }
            }

            // Update connection status display
            function updateConnectionStatus(status) {
                const statusElement = document.getElementById('connectionStatus');
                statusElement.className = `connection-status status-${status}`;

                switch (status) {
                    case 'connected':
                        statusElement.textContent = '🟢 WebSocket';
                        break;
                    case 'api':
                        statusElement.textContent = '🟡 Polling Mode';
                        break;
                    case 'disconnected':
                        statusElement.textContent = '🔴 Disconnected';
                        break;
                    default:
                        statusElement.textContent = '🔄 Connecting';
                }
            }

            // Check if character did not participate in combat
            function isUserInactive(user) {
                // Check if total damage, total DPS, total HPS are all 0
                const totalDamage = user.total_damage?.total || 0;
                const totalDps = user.total_dps || 0;
                const totalHps = user.total_hps || 0;

                // Check if critical rate and lucky rate are NaN
                const critRate = user.total_count?.critical / user.total_count?.total;
                const luckyRate = user.total_count?.lucky / user.total_count?.total;

                return (totalDamage === 0 && totalDps === 0 && totalHps === 0) || (isNaN(critRate) && isNaN(luckyRate));
            }

            // Process data
            function processData(users) {
                users = Object.entries(users)
                    .map(([id, user]) => ({ ...user, id }))
                    .filter((user) => !isUserInactive(user));
                if (!Array.isArray(users)) return;

                // Filter users with health data, max 20
                let validUsers = users.filter((user) => user.hp !== undefined && user.max_hp !== undefined && user.max_hp > 0).slice(0, 20);

                // Sort
                validUsers = sortPlayers(validUsers);

                currentPlayers = validUsers;
                updateUI();
            }

            // Sort players
            function sortPlayers(players) {
                switch (currentSortMode) {
                    case 'hp':
                        return players.sort((a, b) => {
                            const hpPercentA = (a.hp / a.max_hp) * 100;
                            const hpPercentB = (b.hp / b.max_hp) * 100;
                            return hpPercentA - hpPercentB; // Low health first
                        });
                    case 'name':
                        return players.sort((a, b) => {
                            const nameA = (a.name || `UID:${a.id}`).toLowerCase();
                            const nameB = (b.name || `UID:${b.id}`).toLowerCase();
                            return nameA.localeCompare(nameB);
                        });
                    case 'dps':
                        return players.sort((a, b) => (b.total_dps || 0) - (a.total_dps || 0));
                    case 'hps':
                        return players.sort((a, b) => (b.total_hps || 0) - (a.total_hps || 0));
                    default:
                        return players;
                }
            }

            // Update UI
            function updateUI() {
                updatePlayerCount();
                renderPlayerCards();
            }

            // Update player count display
            function updatePlayerCount() {
                const playerCountElement = document.getElementById('playerCount');
                const count = currentPlayers.length;
                playerCountElement.textContent = `Monitoring: ${count}/20 players`;
            }

            // Render player cards
            function renderPlayerCards() {
                const grid = document.getElementById('playerGrid');
                const noDataElement = grid.querySelector('.no-data');

                if (currentPlayers.length === 0) {
                    // Hide all cards
                    playerCards.forEach((card, index) => {
                        setTimeout(() => {
                            card.style.display = 'none';
                        }, index * 20);
                    });

                    // Show no data message
                    if (noDataElement) {
                        setTimeout(
                            () => {
                                noDataElement.style.display = 'block';
                            },
                            playerCards.length * 20 + 100,
                        );
                    }
                    return;
                }

                // Hide no data message
                if (noDataElement) {
                    noDataElement.style.display = 'none';
                }

                // Update existing card content and show
                currentPlayers.forEach((player, index) => {
                    if (index < playerCards.length) {
                        const card = playerCards[index];

                        // If card is currently hidden, show it first then update content
                        if (card.style.display === 'none') {
                            card.style.display = 'flex';
                            card.style.opacity = '0';
                            card.style.transform = 'translateY(20px)';

                            // Delay show animation
                            setTimeout(() => {
                                card.style.opacity = '1';
                                card.style.transform = 'translateY(0)';
                            }, index * 50);
                        }

                        updatePlayerCard(card, player, index);
                    }
                });

                // Hide excess cards
                for (let i = currentPlayers.length; i < playerCards.length; i++) {
                    const card = playerCards[i];
                    if (card.style.display !== 'none') {
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(-10px)';

                        setTimeout(() => {
                            card.style.display = 'none';
                        }, 200);
                    }
                }
            }

            // Pre-generate player cards
            function preGeneratePlayerCards() {
                const grid = document.getElementById('playerGrid');

                // Clear existing content
                grid.innerHTML = '';
                playerCards = [];

                // Create maximum number of cards
                for (let i = 0; i < MAX_CARDS; i++) {
                    const card = createEmptyPlayerCard(i);
                    playerCards.push(card);
                    grid.appendChild(card);
                }

                // Add no data message element
                const noDataElement = document.createElement('div');
                noDataElement.className = 'no-data';
                noDataElement.innerHTML = '<div>📭 No player health bar data available<br>🗺️ Switch servers or maps to refresh health bar data</div>';
                noDataElement.style.display = 'block';
                grid.appendChild(noDataElement);
            }

            // Create empty player card
            function createEmptyPlayerCard(index) {
                const div = document.createElement('div');
                div.className = 'player-card';
                div.style.animationDelay = `${index * 0.05}s`;
                div.style.display = 'none';
                div.style.opacity = '0';
                div.style.transform = 'translateY(20px)';

                div.innerHTML = `
                    <div class="player-info">
                        <div class="player-basic">
                            <div class="player-name" title="">Waiting for data...</div>
                            <div class="player-profession">-</div>
                        </div>
                        <div class="player-stats">
                            <div class="stat-item" title="Total DPS">
                                <span class="stat-icon">⚔️</span>
                                <span class="stat-value">0</span>
                            </div>
                            <div class="stat-item" title="Total HPS">
                                <span class="stat-icon">🩹</span>
                                <span class="stat-value">0</span>
                            </div>
                            <div class="stat-item" title="Total Damage">
                                <span class="stat-icon">💥</span>
                                <span class="stat-value">0</span>
                            </div>
                            <div class="stat-item" title="Total Healing">
                                <span class="stat-icon">❤️</span>
                                <span class="stat-value">0</span>
                            </div>
                        </div>
                    </div>
                    <div class="hp-container">
                        <div class="hp-bar">
                            <div class="hp-fill" style="width: 0%"></div>
                        </div>
                        <div class="hp-text">
                            <span class="hp-current">0</span>
                            <span class="hp-percentage">0%</span>
                            <span class="hp-max">0</span>
                        </div>
                    </div>
                `;

                return div;
            }

            // Update existing player card
            function updatePlayerCard(cardElement, player, index) {
                const hp = player.hp || 0;
                const maxHp = player.max_hp || 1;
                const hpPercent = Math.max(0, Math.min(100, (hp / maxHp) * 100));
                const name = player.name || `UID:${player.id}`;
                const profession = player.profession || 'Unknown';

                // 获取职业信息
                const professionParts = profession.split('-');
                const mainProfession = professionParts[0];
                const subProfession = professionParts[1] || '';
                const professionInfo = professionMap[mainProfession] || { type: 'Unknown', color: '#9E9E9E' };

                // 确定血量状态
                let hpClass = '';
                if (hpPercent <= 25) hpClass = 'hp-critical';
                else if (hpPercent <= 50) hpClass = 'hp-warning';
                else if (hpPercent >= 99) hpClass = 'hp-full';
                else hpClass = 'hp-healthy';

                // 更新卡片类名和样式
                cardElement.className = `player-card profession-${professionInfo.type} ${hpClass}`;
                cardElement.style.setProperty('--profession-color', professionInfo.color);

                // 更新卡片内容
                const playerNameEl = cardElement.querySelector('.player-name');
                const playerProfessionEl = cardElement.querySelector('.player-profession');
                const hpCurrentEl = cardElement.querySelector('.hp-current');
                const hpPercentageEl = cardElement.querySelector('.hp-percentage');
                const hpMaxEl = cardElement.querySelector('.hp-max');
                const hpFillEl = cardElement.querySelector('.hp-fill');
                const statValues = cardElement.querySelectorAll('.stat-value');

                playerNameEl.textContent = name;
                playerNameEl.title = name;

                playerProfessionEl.textContent = professionInfo.short_name || mainProfession + ' ' + subProfession || 'Unknown';
                playerProfessionEl.style.backgroundColor = professionInfo.color;

                hpCurrentEl.textContent = hp;
                hpPercentageEl.textContent = `${hpPercent.toFixed(0)}%`;
                hpMaxEl.textContent = maxHp;
                hpFillEl.style.width = `${hpPercent}%`;

                // 更新统计数据
                if (statValues.length >= 3) {
                    statValues[0].textContent = formatNumber(player.total_dps || 0, 1);
                    statValues[1].textContent = formatNumber(player.total_hps || 0, 1);
                    statValues[2].textContent = formatNumber(player.total_damage?.total || 0);
                    statValues[3].textContent = formatNumber(player.total_healing?.total || 0);
                }
            }

            // 格式化数字
            function formatNumber(num, decimals = 0) {
                if (num === undefined || num === null) return '0';

                const number = parseFloat(num);
                if (isNaN(number)) return '0';

                if (number >= 1000000) {
                    return (number / 1000000).toFixed(decimals) + 'M';
                } else if (number >= 1000) {
                    return (number / 1000).toFixed(decimals) + 'K';
                } else {
                    return number.toFixed(decimals);
                }
            }

            // 设置排序模式
            function setSortMode(mode) {
                currentSortMode = mode;

                // 更新按钮状态
                document.querySelectorAll('.controls .btn').forEach((btn) => {
                    btn.classList.remove('active');
                });
                const targetBtn = document.getElementById(`sort${mode.charAt(0).toUpperCase() + mode.slice(1)}Btn`);
                if (targetBtn) {
                    targetBtn.classList.add('active');
                }

                // 重新排序和渲染
                if (currentPlayers.length > 0) {
                    currentPlayers = sortPlayers(currentPlayers);
                    renderPlayerCards();
                }
            }

            // 页面初始化
            document.addEventListener('DOMContentLoaded', () => {
                // 预生成玩家卡片
                preGeneratePlayerCards();

                // 初始化连接
                initConnection();

                // 键盘快捷键
                document.addEventListener('keydown', (e) => {
                    switch (e.key.toLowerCase()) {
                        case '1':
                            setSortMode('hp');
                            break;
                        case '2':
                            setSortMode('name');
                            break;
                        case '3':
                            setSortMode('dps');
                            break;
                        case '4':
                            setSortMode('hps');
                            break;
                    }
                });
            });
        </script>
    </body>
</html>
